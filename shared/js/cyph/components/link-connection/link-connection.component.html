<div
	fxFlex
	fxFlexFill
	fxLayout="column"
	fxLayoutAlign="center stretch"
	class="link-connection loading"
>
	<div class="logo-animation">
		<div></div>
		<div></div>
		<div></div>
		<div></div>
		<div></div>
	</div>
	<br />
	<div>
		<span
			*ngIf="
				(isPassive | await) &&
				!envService.isTelehealth &&
				(sessionService.chatRequestUsername | await) === undefined
			"
			cyphTranslate
		>
			Waiting for other party to join...
		</span>
		<span
			*ngIf="
				(isPassive | await) &&
				envService.isTelehealth &&
				(sessionService.chatRequestUsername | await) === undefined
			"
			cyphTranslate
		>
			You have successfully checked in. Your telehealth session will begin
			when the other party connects.
		</span>
		<span
			*ngIf="
				(isPassive | await) &&
				(sessionService.chatRequestUsername | await) !== undefined
			"
		>
			<span cyphTranslate>
				Attempting to contact
			</span>
			&ngsp;
			<span>
				@{{ (sessionService.chatRequestUsername | await) || '' }}.
			</span>
		</span>
		<div *ngIf="(isPassive | await) === false">
			<span *ngIf="envService.isTelehealth" cyphTranslate>
				Send the link below to the patient. When they open it, your
				telehealth session will begin.
			</span>
			<span
				class="description"
				[class.mobile]="envService.isMobileOS"
				*ngIf="!envService.isTelehealth"
				cyphTranslate
			>
				Send the link below to another user. When they open it, you'll
				be securely connected.
			</span>
			<br />
			<br />

			<div fxLayoutAlign="center center" *ngIf="!envService.isMobileOS">
				<mat-form-field fxFlex="50">
					<input
						matInput
						class="connect-link-input"
						[ngModel]="link | await"
						(ngModelChange)="resetLinkValue($event)"
						(blur)="onBlur()"
						(click)="onBlur()"
						(keydown)="onBlur()"
						[matTooltip]="stringsService.linkTooltip"
					/>
				</mat-form-field>
				<button
					mat-icon-button
					matTooltip="Email"
					(click)="email()"
					cyphTranslate
				>
					<mat-icon>email</mat-icon>
				</button>
				<button
					mat-icon-button
					matTooltip="Copy to Clipboard"
					(click)="copyToClipboard()"
					cyphTranslate
				>
					<mat-icon>content_copy</mat-icon>
				</button>
			</div>

			<div class="connect-link-mobile" *ngIf="envService.isMobileOS">
				<a
					class="connect-link-link"
					[href]="linkHref | await"
					[matTooltip]="stringsService.linkTooltip"
					>{{ link | await }}</a
				>

				<br />
				<br />

				<a
					mat-mini-fab
					matTooltip="SMS"
					[href]="linkSMS | await"
					cyphTranslate
				>
					<mat-icon>textsms</mat-icon>
				</a>

				<span class="divider">
					&nbsp;
				</span>

				<button
					mat-mini-fab
					matTooltip="Email"
					(click)="email()"
					cyphTranslate
				>
					<mat-icon>email</mat-icon>
				</button>

				<span class="divider">
					&nbsp;
				</span>

				<button
					mat-mini-fab
					matTooltip="Copy to Clipboard"
					(click)="copyToClipboard()"
					cyphTranslate
				>
					<mat-icon>content_copy</mat-icon>
				</button>
			</div>
		</div>

		<br />
		<div
			class="timer"
			*ngIf="timer !== undefined && (isPassive | await) === false"
		>
			<span cyphTranslate>
				Link expires in
			</span>
			&ngsp;
			<span class="countdown">
				{{ timer.timestamp | await }}
			</span>
			&ngsp;
			<button
				mat-icon-button
				(click)="addTime(60000)"
				matTooltip="Increase Time by One Minute"
				cyphTranslate
			>
				<mat-icon>alarm_add</mat-icon>
			</button>

			<ng-container *ngIf="envService.pro | await">
				&ngsp;
				<mat-select
					cyphTranslate
					class="add-time-select"
					ngClass.lt-md="mobile"
					placeholder="Add More Time"
				>
					<mat-option (click)="addTime(600000)">
						10 Minutes
					</mat-option>
					<mat-option (click)="addTime(1800000)">
						30 Minutes
					</mat-option>
					<mat-option (click)="addTime(3600000)">
						1 Hour
					</mat-option>
					<mat-option (click)="addTime(43200000)">
						12 Hours
					</mat-option>
				</mat-select>
			</ng-container>
		</div>
	</div>

	<ng-container *ngIf="!envService.isMobileOS">
		<br />

		<div fxLayoutAlign="center center" *ngIf="false">
			<img
				cyphTranslate
				alt="QR Code"
				[src]="qrSrc"
				*ngIf="
					(qrService.getQRCode({
						dotScale: 0.75,
						size: 128,
						text: (link | await) || ''
					}) | await) || '' as qrSrc
				"
			/>
		</div>

		<br />
	</ng-container>

	<div
		fxLayout="row"
		fxLayoutAlign="center center"
		[class.ad]="envService.showAds"
		[class.mobile]="envService.isMobile | await"
	>
		<ng-container *ngIf="envService.showAds; else proContent">
			<ng-content></ng-content>
		</ng-container>
		<ng-template #proContent>
			<div
				fxFlex
				fxFlex.gt-md="50"
				fxLayout="column"
				*ngIf="envService.pro | await"
			>
				<div fxLayout="row" fxLayoutAlign="center center">
					<mat-slide-toggle
						[ngModel]="advancedFeatures | await"
						(ngModelChange)="advancedFeatures.next($event)"
						cyphTranslate
					>
						Advanced Features
					</mat-slide-toggle>
				</div>

				<div
					fxLayout="row"
					fxLayoutGap="16px"
					*ngIf="advancedFeatures | await"
				>
					<mat-form-field fxFlex fxLayout="column">
						<textarea
							matInput
							cyphTranslate
							[ngModel]="queuedMessageDraft | await"
							(ngModelChange)="queuedMessageDraft.next($event)"
							placeholder="Queue up first message"
							rows="3"
						></textarea>
					</mat-form-field>
					<div fxLayout="row">
						<div
							fxLayout="column"
							fxLayoutAlign="center center"
							fxLayoutGap="8px"
						>
							<button
								mat-icon-button
								matTooltip="Save"
								cyphTranslate
								(click)="
									chatService.setQueuedMessage(
										queuedMessageDraft.value
									)
								"
							>
								<mat-icon>save</mat-icon>
							</button>
							<mat-button-toggle
								matTooltip="Self-Destruct"
								cyphTranslate
								[checked]="chatService.chatSelfDestruct | await"
								(change)="
									chatService.chatSelfDestruct.next(
										!chatService.chatSelfDestruct.value
									)
								"
							>
								<mat-icon>timer</mat-icon>
							</mat-button-toggle>
						</div>
						<div
							*ngIf="chatService.chatSelfDestruct | await"
							class="self-destruct-timer"
						>
							<mat-form-field>
								<input
									matInput
									[ngModel]="
										chatService.chatSelfDestructTimeout
											| await
									"
									(ngModelChange)="
										chatService.chatSelfDestructTimeout.next(
											$event
										)
									"
									name="timer"
									max="9999"
									type="number"
								/>
							</mat-form-field>
							&nbsp;
							<span cyphTranslate>Seconds</span>
						</div>
					</div>
					<div
						fxLayout="column"
						fxLayoutAlign="center center"
						fxLayoutGap="8px"
					>
						<mat-button-toggle
							matTooltip="Walkie Talkie Mode"
							cyphTranslate
							[checked]="chatService.walkieTalkieMode | await"
							(change)="
								chatService.walkieTalkieMode.next(
									!chatService.walkieTalkieMode.value
								)
							"
						>
							<mat-icon svgIcon="walkie-talkie"></mat-icon>
						</mat-button-toggle>
					</div>
				</div>
			</div>
		</ng-template>
	</div>
</div>
