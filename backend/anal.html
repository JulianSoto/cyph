<html>
	<body>
		<!--
			Google Analytics is used for traffic logging and event tracking.
			To reduce trust in Google, the following steps are taken:

			* The JS is run in a sandboxed iframe (hence isn't problematic
			  for the threat model of WebSign)
			
			* We're hosting the JS ourselves

			* IP anonymization is enabled:
			  https://support.google.com/analytics/answer/2763052

			* ~~Rather than make a direct connection from the client to GA,
			  we're proxying all requests as per
			  https://github.com/ZitRos/save-analytics-from-content-blockers~~
		-->
		<script
			async
			src="https://www.googletagmanager.com/gtag/js?id=UA-56220601-1"
		></script>
		<script>
			try {
				window.dataLayer = window.dataLayer || [];
				function gtag ()  {
					dataLayer.push(arguments);
				}
				gtag('js', new Date());

				gtag('config', 'UA-56220601-1', {
					anonymize_ip: true,
					send_page_view: true
				});

				var referrer = decodeURIComponent(
					((location.search || '').split('ref=')[1] || '').split(
						'&'
					)[0] || ''
				);

				if (referrer) {
					gtag('set', {referrer: referrer});
				}

				function onmessage (e)  {
					try {
						var args = e.data.args ? JSON.parse(e.data.args) : [];

						for (var i = 0; i < args.length; ++i) {
							var arg = args[i];
							var callbackID = arg && arg.callbackID;

							if (callbackID) {
								args[i] = function ()  {
									e.source.postMessage(
										{
											callbackID: callbackID,
											args: JSON.stringify(
												Array.prototype.slice.call(
													arguments
												)
											)
										},
										e.origin
									);
								};
							}
						}

						gtag.apply(gtag, args);
					}
					catch (_) {}
				}

				window.addEventListener('message', onmessage, false);
			}
			catch (_) {}
		</script>
	</body>
</html>
